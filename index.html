<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å·¥æ—¶è®¡ç®—å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
        }

        .calculator-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 1.5rem;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            color: #6b7280;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        input[type="time"], input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            flex: 1;
            font-size: 1rem;
            color: #333;
        }

        input[type="number"] {
            width: 80px;
            flex: none;
        }

        button {
            cursor: pointer;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .btn-add {
            background-color: #e0e7ff;
            color: #4f46e5;
            width: 100%;
            margin-top: 5px;
        }
        .btn-add:hover { background-color: #c7d2fe; }

        .btn-remove {
            background-color: #fee2e2;
            color: #dc2626;
            padding: 8px 12px;
        }
        .btn-remove:hover { background-color: #fecaca; }

        .btn-calculate {
            background-color: #10b981;
            color: white;
            width: 100%;
            font-size: 1.1rem;
            padding: 12px;
            font-weight: bold;
            margin-top: 10px;
        }
        .btn-calculate:hover { background-color: #059669; }

        #result, #result2 {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            color: #166534;
            text-align: center;
            font-size: 1.1rem;
            line-height: 1.6;
            display: none;
        }
        
        .detail-text {
            display: block;
            font-size: 0.85em;
            color: #666;
            font-weight: normal;
            margin-top: 5px;
        }

        .error {
            color: #dc2626;
            background-color: #fee2e2;
            border-color: #fecaca;
        }

        .time-unit {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .highlight {
            font-size: 1.3em;
            color: #10b981;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="calculator-card">
    <h2>â±ï¸ æ™ºèƒ½å·¥æ—¶è®¡ç®—å™¨</h2>

    <div class="tab-container">
        <button class="tab active" onclick="switchTab('mode1')">ğŸ“Š è®¡ç®—å‡€å·¥æ—¶</button>
        <button class="tab" onclick="switchTab('mode2')">ğŸ• è®¡ç®—ä¸‹ç­æ—¶é—´</button>
    </div>

    <!-- æ¨¡å¼1ï¼šè®¡ç®—å‡€å·¥æ—¶ -->
    <div id="mode1" class="tab-content active">
        <div class="section">
            <label>å·¥ä½œæ—¶é—´</label>
            <div class="input-group">
                <input type="time" id="startWork" required>
                <span>è‡³</span>
                <input type="time" id="endWork" required>
            </div>
        </div>

        <div class="section">
            <label>ä¼‘æ¯æ—¶é—´ (ä»…æ‰£é™¤æœ‰æ•ˆé‡å æ—¶é—´)</label>
            <div id="breaksContainer"></div>
            <button class="btn-add" onclick="addBreakField()">+ æ·»åŠ ä¸€æ®µä¼‘æ¯æ—¶é—´</button>
        </div>

        <button class="btn-calculate" onclick="calculateHours()">è®¡ç®—å‡€å·¥æ—¶</button>
        <div id="result"></div>
    </div>

    <!-- æ¨¡å¼2ï¼šè®¡ç®—æœ€æ—©ä¸‹ç­æ—¶é—´ -->
    <div id="mode2" class="tab-content">
        <div class="section">
            <label>ä¸Šç­æ—¶é—´</label>
            <div class="input-group">
                <input type="time" id="startWork2" required>
            </div>
        </div>

        <div class="section">
            <label>ç›®æ ‡å·¥ä½œæ—¶é•¿</label>
            <div class="input-group">
                <div class="time-unit">
                    <input type="number" id="targetHours" min="0" max="24" value="8">
                    <span>å°æ—¶</span>
                </div>
                <div class="time-unit">
                    <input type="number" id="targetMinutes" min="0" max="59" value="0">
                    <span>åˆ†é’Ÿ</span>
                </div>
            </div>
        </div>

        <div class="section">
            <label>é¢„è®¡ä¼‘æ¯æ—¶é—´</label>
            <div id="breaksContainer2"></div>
            <button class="btn-add" onclick="addBreakField2()">+ æ·»åŠ ä¸€æ®µä¼‘æ¯æ—¶é—´</button>
        </div>

        <button class="btn-calculate" onclick="calculateOffTime()">è®¡ç®—æœ€æ—©ä¸‹ç­æ—¶é—´</button>
        <div id="result2"></div>
    </div>
</div>

<script>
    // === åˆå§‹åŒ– ===
    addBreakField('12:30', '14:00');
    addBreakField2('12:30', '14:00');

    function switchTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tabId).classList.add('active');
    }

    function addBreakField(defaultStart = '', defaultEnd = '') {
        const container = document.getElementById('breaksContainer');
        const div = document.createElement('div');
        div.className = 'input-group break-row';
        div.innerHTML = `
            <input type="time" class="break-start" value="${defaultStart}">
            <span>è‡³</span>
            <input type="time" class="break-end" value="${defaultEnd}">
            <button class="btn-remove" onclick="removeBreak(this)">åˆ é™¤</button>
        `;
        container.appendChild(div);
    }

    function addBreakField2(defaultStart = '', defaultEnd = '') {
        const container = document.getElementById('breaksContainer2');
        const div = document.createElement('div');
        div.className = 'input-group break-row';
        div.innerHTML = `
            <input type="time" class="break-start" value="${defaultStart}">
            <span>è‡³</span>
            <input type="time" class="break-end" value="${defaultEnd}">
            <button class="btn-remove" onclick="removeBreak(this)">åˆ é™¤</button>
        `;
        container.appendChild(div);
    }

    function removeBreak(button) {
        button.parentElement.remove();
    }

    function timeToMinutes(timeStr) {
        if (!timeStr) return null;
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    }

    function minutesToTime(minutes) {
        const days = Math.floor(minutes / 1440);
        minutes = minutes % 1440;
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        
        let timeStr = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
        if (days > 0) {
            timeStr += ` (æ¬¡æ—¥)`;
        }
        return timeStr;
    }

    function getIntersection(range1Start, range1End, range2Start, range2End) {
        const start = Math.max(range1Start, range2Start);
        const end = Math.min(range1End, range2End);
        return Math.max(0, end - start);
    }

    // === æ¨¡å¼1ï¼šè®¡ç®—å‡€å·¥æ—¶ ===
    function calculateHours() {
        const startWorkStr = document.getElementById('startWork').value;
        const endWorkStr = document.getElementById('endWork').value;
        const resultDiv = document.getElementById('result');

        resultDiv.className = '';
        resultDiv.style.display = 'block';

        if (!startWorkStr || !endWorkStr) {
            resultDiv.innerText = "âš ï¸ è¯·å¡«å†™å®Œæ•´çš„ä¸Šç­å’Œä¸‹ç­æ—¶é—´";
            resultDiv.className = 'error';
            return;
        }

        let wStart = timeToMinutes(startWorkStr);
        let wEnd = timeToMinutes(endWorkStr);

        if (wEnd < wStart) {
            wEnd += 24 * 60;
        }

        const totalWorkSpan = wEnd - wStart;
        let validBreakMinutes = 0;

        const breakRows = document.querySelectorAll('#breaksContainer .break-row');
        
        for (let row of breakRows) {
            const bStartStr = row.querySelector('.break-start').value;
            const bEndStr = row.querySelector('.break-end').value;

            if (bStartStr && bEndStr) {
                let bStart = timeToMinutes(bStartStr);
                let bEnd = timeToMinutes(bEndStr);

                if (bEnd < bStart) {
                    bEnd += 24 * 60;
                }

                let overlap1 = getIntersection(wStart, wEnd, bStart, bEnd);
                let overlap2 = getIntersection(wStart, wEnd, bStart + 1440, bEnd + 1440);

                validBreakMinutes += Math.max(overlap1, overlap2);
            }
        }

        let netWorkMinutes = totalWorkSpan - validBreakMinutes;

        const hours = Math.floor(netWorkMinutes / 60);
        const minutes = netWorkMinutes % 60;
        
        const totalHours = Math.floor(totalWorkSpan / 60);
        const totalMin = totalWorkSpan % 60;

        resultDiv.innerHTML = `
            <strong>å‡€å·¥ä½œæ—¶é•¿: ${hours} å°æ—¶ ${minutes} åˆ†é’Ÿ</strong>
            <span class="detail-text">
                ä¸Šä¸‹ç­è·¨åº¦: ${totalHours}å°æ—¶${totalMin}åˆ†<br>
                æœ‰æ•ˆæ‰£é™¤ä¼‘æ¯: ${validBreakMinutes} åˆ†é’Ÿ
            </span>
        `;
    }

    // === æ¨¡å¼2ï¼šè®¡ç®—æœ€æ—©ä¸‹ç­æ—¶é—´ï¼ˆä¿®æ­£ç‰ˆï¼‰===
    function calculateOffTime() {
        const startWorkStr = document.getElementById('startWork2').value;
        const targetHours = parseInt(document.getElementById('targetHours').value) || 0;
        const targetMinutes = parseInt(document.getElementById('targetMinutes').value) || 0;
        const resultDiv = document.getElementById('result2');

        resultDiv.className = '';
        resultDiv.style.display = 'block';

        if (!startWorkStr) {
            resultDiv.innerText = "âš ï¸ è¯·å¡«å†™ä¸Šç­æ—¶é—´";
            resultDiv.className = 'error';
            return;
        }

        const targetWorkMinutes = targetHours * 60 + targetMinutes;
        if (targetWorkMinutes <= 0) {
            resultDiv.innerText = "âš ï¸ ç›®æ ‡å·¥ä½œæ—¶é•¿å¿…é¡»å¤§äº0";
            resultDiv.className = 'error';
            return;
        }

        let currentTime = timeToMinutes(startWorkStr);
        let workedMinutes = 0;
        
        // æ”¶é›†å¹¶æ’åºæ‰€æœ‰ä¼‘æ¯æ—¶é—´æ®µ
        const breakPeriods = [];
        const breakRows = document.querySelectorAll('#breaksContainer2 .break-row');
        
        for (let row of breakRows) {
            const bStartStr = row.querySelector('.break-start').value;
            const bEndStr = row.querySelector('.break-end').value;

            if (bStartStr && bEndStr) {
                let bStart = timeToMinutes(bStartStr);
                let bEnd = timeToMinutes(bEndStr);
                if (bEnd < bStart) bEnd += 1440;
                breakPeriods.push({ start: bStart, end: bEnd });
            }
        }

        breakPeriods.sort((a, b) => a.start - b.start);

        // é€æ®µè®¡ç®—å·¥ä½œæ—¶é—´
        for (let breakPeriod of breakPeriods) {
            let { start, end } = breakPeriod;
            
            // å¦‚æœä¼‘æ¯æ—¶é—´è¿˜æ²¡åˆ°ï¼Œå…ˆå·¥ä½œåˆ°ä¼‘æ¯å¼€å§‹
            if (start > currentTime) {
                const canWork = start - currentTime;
                const needWork = targetWorkMinutes - workedMinutes;
                
                if (canWork >= needWork) {
                    // åœ¨ä¼‘æ¯å‰å°±èƒ½å®Œæˆç›®æ ‡å·¥æ—¶
                    currentTime += needWork;
                    workedMinutes = targetWorkMinutes;
                    break;
                } else {
                    // å·¥ä½œåˆ°ä¼‘æ¯æ—¶é—´
                    workedMinutes += canWork;
                    currentTime = end; // è·³è¿‡ä¼‘æ¯æ—¶é—´
                }
            } else if (end > currentTime) {
                // å½“å‰æ—¶é—´åœ¨ä¼‘æ¯æ—¶é—´æ®µå†…ï¼Œè·³åˆ°ä¼‘æ¯ç»“æŸ
                currentTime = end;
            }
        }

        // å¦‚æœè¿˜æ²¡å®Œæˆç›®æ ‡å·¥æ—¶ï¼Œç»§ç»­å¾€ååŠ 
        if (workedMinutes < targetWorkMinutes) {
            currentTime += (targetWorkMinutes - workedMinutes);
        }

        const offTime = minutesToTime(currentTime);
        const totalSpan = currentTime - timeToMinutes(startWorkStr);
        const spanHours = Math.floor(totalSpan / 60);
        const spanMins = totalSpan % 60;
        const totalBreak = totalSpan - targetWorkMinutes;

        resultDiv.innerHTML = `
            <strong>æœ€æ—©ä¸‹ç­æ—¶é—´: <span class="highlight">${offTime}</span></strong>
            <span class="detail-text">
                ç›®æ ‡å·¥æ—¶: ${targetHours}å°æ—¶${targetMinutes}åˆ†<br>
                æ€»è·¨åº¦: ${spanHours}å°æ—¶${spanMins}åˆ† (å«ä¼‘æ¯${totalBreak}åˆ†é’Ÿ)
            </span>
        `;
    }
</script>

</body>
</html>


